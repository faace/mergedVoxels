!function(t){var i={};function e(o){if(i[o])return i[o].exports;var r=i[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var r in t)e.d(o,r,function(i){return t[i]}.bind(null,r));return o},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=3)}([function(t,i){var e=function(t){this.init(t)};e.prototype.init=function(t){return this.info=t,this.map=JSON.parse(JSON.stringify(t.map))||{},this.textures=this.info.textures||{},this.width=t.width||1,this.height=t.height||1,this.depth=t.depth||1,this.align=t.align,this.showFaces=t.showFaces||{front:!0,back:!0,left:!0,right:!0,top:!0,bottom:!0},this},e.prototype.run=function(t){this.bound||(this.bound=this.getBound(this.map)),this.center||(this.center=this.getCenter(this.align));var i=this.buildVertices(),e=this.buildFaces(i);this.updateVertices(i),this.updateFaces(i,e),this.materials=[],this.materialsMap={},this.texturesMap={};var o=this.createGeometry(i,e);t(!1,new THREE.Mesh(o,this.materials))},e.prototype.getMaterial=function(t,i,e){var o=this.textures;if(o[t]){var r,n=o[t];if("string"!=typeof n)r=n.src;else{var a=document.querySelector("#"+o[t]);r=a&&(a.src||a[0]&&a[0].src)}if(r){var s=(new THREE.TextureLoader).load(r);return s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping,s.repeat.set(i,e),new THREE.MeshBasicMaterial({map:s})}}return new THREE.MeshPhongMaterial({color:t})},e.prototype.getMaterialIdx=function(t,i,e){var o=t.color,r=t.opacity,n=o+"_"+r+"_"+i+"_"+e;if(void 0===this.materialsMap[n]){var a=this.getMaterial(o,i,e);r&&(a.transparent=!0,a.opacity=r),this.materialsMap[n]=this.materials.length,this.materials.push(a)}return this.materialsMap[n]},e.prototype.createGeometry=function(t,i){for(var e=new THREE.Geometry,o=0;o<t.length;o++)t[o][3]&&e.vertices.push(new THREE.Vector3(t[o][0],t[o][1],t[o][2]));e.computeBoundingBox();var r,n,a=e.faceVertexUvs[0],s=new THREE.Vector2(0,0),h=new THREE.Vector2(1,0),f=new THREE.Vector2(1,1),p=[s,h,f],c=[s,f,new THREE.Vector2(0,1)];for(o=0;o<i.length;o++)r=i[o],n=this.getMaterialIdx(r[3],r[4],r[5]),e.faces.push(new THREE.Face3(r[0],r[1],r[2],void 0,void 0,n)),a.push(p,c);return e.computeFaceNormals(),e},e.prototype.updateFaces=function(t,i){for(var e=0;e<i.length;e++)i[e][0]=t[i[e][0]][4],i[e][1]=t[i[e][1]][4],i[e][2]=t[i[e][2]][4]},e.prototype.updateVertices=function(t){for(var i=0,e=0;e<t.length;e++)t[e][3]&&(t[e][4]=i++)},e.prototype.isSameMaterial=function(t,i,e,o,r){return!!(t[e]&&t[e][o]&&t[e][o][i]&&t[e][o][i].color==r.color&&t[e][o][i].opacity==r.opacity)},e.prototype.FindAndSetPointBottom=function(t,i,e,o,r,n){var a,s,h,f="bottom",p=i[o][r][e];for(n.x=e,n.y=o,n.z=r,a=e;a<=t.maxX&&(this.isSameMaterial(i,a,o,r,p)&&!i[o][r][a][f]);a++)i[o][r][a][f]=!0,n.x=a;for(s=r+1;s<=t.maxZ;s++){for(h=!1,a=e;a<=n.x;a++)if(!this.isSameMaterial(i,a,o,s,p)||i[o][s][a][f]){h=!0;break}if(h)break;for(a=e;a<=n.x;a++)i[o][s][a][f]=!0;n.z=s}},e.prototype.FindAndSetPointTop=function(t,i,e,o,r,n){var a,s,h,f=i[o][r][e];for(n.x=e,n.y=o,n.z=r,a=e;a<=t.maxX&&(this.isSameMaterial(i,a,o,r,f)&&!i[o][r][a].top);a++)i[o][r][a].top=!0,n.x=a;for(s=r-1;s>=t.minZ;s--){for(h=!1,a=e;a<=n.x;a++)if(!this.isSameMaterial(i,a,o,s,f)||i[o][s][a].top){h=!0;break}if(h)break;for(a=e;a<=n.x;a++)i[o][s][a].top=!0;n.z=s}},e.prototype.FindAndSetPointRight=function(t,i,e,o,r,n){var a,s,h,f=i[o][r][e];for(n.x=e,n.y=o,n.z=r,s=r;s>=t.minZ&&(this.isSameMaterial(i,e,o,s,f)&&!i[o][s][e].right);s--)i[o][s][e].right=!0,n.z=s;for(a=o+1;a<=t.maxY;a++){for(h=!1,s=r;s>=n.z;s--)if(!this.isSameMaterial(i,e,a,s,f)||i[a][s][e].right){h=!0;break}if(h)break;for(s=r;s>=n.z;s--)i[a][s][e].right=!0;n.y=a}},e.prototype.FindAndSetPointLeft=function(t,i,e,o,r,n){var a,s,h,f=i[o][r][e];for(n.x=e,n.y=o,n.z=r,s=r;s<=t.maxZ&&(this.isSameMaterial(i,e,o,s,f)&&!i[o][s][e].left);s++)i[o][s][e].left=!0,n.z=s;for(a=o+1;a<=t.maxY;a++){for(h=!1,s=r;s<=n.z;s++)if(!this.isSameMaterial(i,e,a,s,f)||i[a][s][e].left){h=!0;break}if(h)break;for(s=r;s<=n.z;s++)i[a][s][e].left=!0;n.y=a}},e.prototype.FindAndSetPointBack=function(t,i,e,o,r,n){var a,s,h,f=i[o][r][e];for(n.x=e,n.y=o,n.z=r,a=e;a>=t.minX&&(this.isSameMaterial(i,a,o,r,f)&&!i[o][r][a].back);a--)i[o][r][a].back=!0,n.x=a;for(s=o+1;s<=t.maxY;s++){for(h=!1,a=e;a>=n.x;a--)if(!this.isSameMaterial(i,a,s,r,f)||i[s][r][a].back){h=!0;break}if(h)break;for(a=e;a>=n.x;a--)i[s][r][a].back=!0;n.y=s}},e.prototype.FindAndSetPointFront=function(t,i,e,o,r,n){var a,s,h,f=i[o][r][e];for(n.x=e,n.y=o,n.z=r,a=e;a<=t.maxX&&(this.isSameMaterial(i,a,o,r,f)&&!i[o][r][a].front);a++)i[o][r][a].front=!0,n.x=a;for(s=o+1;s<=t.maxY;s++){for(h=!1,a=e;a<=n.x;a++)if(!this.isSameMaterial(i,a,s,r,f)||i[s][r][a].front){h=!0;break}if(h)break;for(a=e;a<=n.x;a++)i[s][r][a].front=!0;n.y=s}},e.prototype.canIgnore=function(t,i,e,o,r,n,a){if(!t[e][o][i])return!0;if(t[n]&&t[n][a]&&t[n][a][r]){if(void 0===t[n][a][r].opacity||t[n][a][r].opacity>=1)return!0;if(t[e][o][i].opacity==t[n][a][r].opacity&&t[e][o][i].color==t[n][a][r].color)return!0}return!1},e.prototype.getPointIdx=function(t,i,e,o){var r=e-t.minY,n=o-t.minZ,a=i-t.minX,s=r*t.width*t.depth;return s+=n*t.width,8*(s+=a)},e.prototype.buildAFace=function(t,i,e,o,r,n,a,s,h){t.push([i,e,o,a,s,h]),t.push([i,o,r,a,s,h]),n[i][3]++,n[e][3]++,n[o][3]++,n[r][3]++},e.prototype.buildFaces=function(t){var i,e,o,r,n,a,s,h=this.bound,f=this.map,p=[],c={x:0,y:0,z:0};if(this.showFaces.front)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i,e+1)||f[i][e][o].front||(this.FindAndSetPointFront(h,f,o,i,e,c),r=this.getPointIdx(h,o,i,e),n=this.getPointIdx(h,c.x,i,e),a=this.getPointIdx(h,c.x,c.y,e),s=this.getPointIdx(h,o,c.y,e),this.buildAFace(p,r,n+1,a+2,s+3,t,f[i][e][o],Math.abs(o-c.x)+1,Math.abs(i-c.y)+1)));if(this.showFaces.back)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(o=h.maxX;o>=h.minX;o--)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i,e-1)||f[i][e][o].back||(this.FindAndSetPointBack(h,f,o,i,e,c),r=this.getPointIdx(h,o,i,e),n=this.getPointIdx(h,c.x,i,e),a=this.getPointIdx(h,c.x,c.y,e),s=this.getPointIdx(h,o,c.y,e),this.buildAFace(p,r+5,n+4,a+7,s+6,t,f[i][e][o],Math.abs(o-c.x)+1,Math.abs(i-c.y)+1)));if(this.showFaces.left)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o-1,i,e)||f[i][e][o].left||(this.FindAndSetPointLeft(h,f,o,i,e,c),r=this.getPointIdx(h,o,i,e),n=this.getPointIdx(h,o,i,c.z),a=this.getPointIdx(h,o,c.y,c.z),s=this.getPointIdx(h,o,c.y,e),this.buildAFace(p,r+4,n,a+3,s+7,t,f[i][e][o],Math.abs(e-c.z)+1,Math.abs(i-c.y)+1)));if(this.showFaces.right)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(o=h.maxX;o>=h.minX;o--)f[i][e][o]&&(this.canIgnore(f,o,i,e,o+1,i,e)||f[i][e][o].right||(this.FindAndSetPointRight(h,f,o,i,e,c),r=this.getPointIdx(h,o,i,e),n=this.getPointIdx(h,o,i,c.z),a=this.getPointIdx(h,o,c.y,c.z),s=this.getPointIdx(h,o,c.y,e),this.buildAFace(p,r+1,n+5,a+6,s+2,t,f[i][e][o],Math.abs(e-c.z)+1,Math.abs(i-c.y)+1)));if(this.showFaces.top)for(i=h.maxY;i>=h.minY;i--)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i+1,e)||f[i][e][o].top||(this.FindAndSetPointTop(h,f,o,i,e,c),r=this.getPointIdx(h,o,i,e),n=this.getPointIdx(h,c.x,i,e),a=this.getPointIdx(h,c.x,i,c.z),s=this.getPointIdx(h,o,i,c.z),this.buildAFace(p,r+3,n+2,a+6,s+7,t,f[i][e][o],Math.abs(o-c.x)+1,Math.abs(e-c.z)+1)));if(this.showFaces.bottom)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i-1,e)||f[i][e][o].bottom||(this.FindAndSetPointBottom(h,f,o,i,e,c),r=this.getPointIdx(h,o,i,e),n=this.getPointIdx(h,c.x,i,e),a=this.getPointIdx(h,c.x,i,c.z),s=this.getPointIdx(h,o,i,c.z),this.buildAFace(p,r+4,n+5,a+1,s+0,t,f[i][e][o],Math.abs(o-c.x)+1,Math.abs(e-c.z)+1)));return p},e.prototype.buildVertices=function(){var t,i,e,o,r,n,a=this.bound,s=this.width,h=this.height,f=this.depth,p=this.center,c=[],m=0,u=.5*s,x=.5*h,d=.5*f;for(t=a.minY;t<=a.maxY;t++)for(i=a.minZ;i<=a.maxZ;i++)for(e=a.minX;e<=a.maxX;e++)o=-p.x+e*s,r=-p.y+t*h,n=-p.z+i*f,c.push([o-u,r-x,n+d,0,m++]),c.push([o+u,r-x,n+d,0,m++]),c.push([o+u,r+x,n+d,0,m++]),c.push([o-u,r+x,n+d,0,m++]),c.push([o-u,r-x,n-d,0,m++]),c.push([o+u,r-x,n-d,0,m++]),c.push([o+u,r+x,n-d,0,m++]),c.push([o-u,r+x,n-d,0,m++]);return c},e.prototype.getCenter2=function(t,i,e,o){return t*e+(i-t)*e*o},e.prototype.getCenter=function(t){var i,e,o,r,n,a,s=this.bound,h=this.width,f=this.height,p=this.depth,c={};return void 0===t&&(t="center"),"string"==typeof t?(t=t.trim(),aligns=t.split(" "),3==aligns.length?("left"==aligns[0]?(i=0,r=-.5):"right"==aligns[0]?(i=1,r=.5):(i=.5,r=0),"bottom"==aligns[1]?(e=0,n=-.5):"top"==aligns[1]?(e=1,n=.5):(e=.5,n=0),"back"==aligns[2]?(o=0,a=-.5):"front"==aligns[2]?(o=1,a=.5):(o=.5,a=0)):"left"==t?(i=e=o=0,r=n=a=-.5):"right"==t?(i=e=o=1,r=n=a=.5):(i=e=o=.5,r=n=a=0),console.log(a,o),c.x=this.getCenter2(s.minX,s.maxX,h,i)+r*h,c.y=this.getCenter2(s.minY,s.maxY,f,e)+n*f,c.z=this.getCenter2(s.minZ,s.maxZ,p,o)+a*p):(c.x=t.x,c.y=t.y,c.z=t.z),console.log(c),c},e.prototype.getBound=function(t){var i,e,o,r,n=1/0,a=-1/0,s=1/0,h=-1/0,f=1/0,p=-1/0;for(i in t)for(e in n=Math.min(n,i),a=Math.max(a,i),r=t[i])for(o in s=Math.min(s,e),h=Math.max(h,e),r[e])f=Math.min(f,o),p=Math.max(p,o);return{minY:n,maxY:a,minZ:s,maxZ:h,minX:f,maxX:p,width:p-f+1,height:a-n+1,depth:h-s+1}}},,,function(t,i,e){t.exports=e(0)}]);