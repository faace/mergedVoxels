!function(t){var i={};function e(r){if(i[r])return i[r].exports;var o=i[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(r,o,function(i){return t[i]}.bind(null,o));return r},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=1)}([function(t,i){var e=function(t){this.init(t)};e.prototype.init=function(t){return this.info=t,this.map=JSON.parse(JSON.stringify(t.map))||{},this.textures=this.info.textures||{},this.width=t.width||1,this.height=t.height||1,this.depth=t.depth||1,this.align=t.align,this.showFaces=t.showFaces||{front:!0,back:!0,left:!0,right:!0,top:!0,bottom:!0},this},e.prototype.run=function(t){this.bound||(this.bound=this.getBound(this.map)),this.center||(this.center=this.getCenter(this.align));var i=this.buildVertices(),e=this.buildFaces(i);this.updateVertices(i),this.updateFaces(i,e),this.materials=[],this.materialsMap={},this.texturesMap={};var r=this.createGeometry(i,e);t(!1,new THREE.Mesh(r,this.materials))},e.prototype.getMaterial=function(t,i,e){var r=this.textures;if(r[t]){var o,n=r[t];if("string"!=typeof n)o=n.src;else{var a=document.querySelector("#"+r[t]);o=a&&(a.src||a[0]&&a[0].src)}if(o){var s=(new THREE.TextureLoader).load(o);return s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping,s.repeat.set(i,e),new THREE.MeshBasicMaterial({map:s})}}return new THREE.MeshPhongMaterial({color:t})},e.prototype.getMaterialIdx=function(t,i,e){var r=t.color,o=t.opacity,n=r+"_"+o+"_"+i+"_"+e;if(void 0===this.materialsMap[n]){var a=this.getMaterial(r,i,e);o&&(a.transparent=!0,a.opacity=o),this.materialsMap[n]=this.materials.length,this.materials.push(a)}return this.materialsMap[n]},e.prototype.createGeometry=function(t,i){for(var e=new THREE.Geometry,r=0;r<t.length;r++)t[r][3]&&e.vertices.push(new THREE.Vector3(t[r][0],t[r][1],t[r][2]));e.computeBoundingBox();var o,n,a=e.faceVertexUvs[0],s=new THREE.Vector2(0,0),h=new THREE.Vector2(1,0),f=new THREE.Vector2(1,1),c=[s,h,f],p=[s,f,new THREE.Vector2(0,1)];for(r=0;r<i.length;r++)o=i[r],n=this.getMaterialIdx(o[3],o[4],o[5]),e.faces.push(new THREE.Face3(o[0],o[1],o[2],void 0,void 0,n)),a.push(c,p);return e.computeFaceNormals(),e},e.prototype.updateFaces=function(t,i){for(var e=0;e<i.length;e++)i[e][0]=t[i[e][0]][4],i[e][1]=t[i[e][1]][4],i[e][2]=t[i[e][2]][4]},e.prototype.updateVertices=function(t){for(var i=0,e=0;e<t.length;e++)t[e][3]&&(t[e][4]=i++)},e.prototype.isSameMaterial=function(t,i,e,r,o){return!!(t[e]&&t[e][r]&&t[e][r][i]&&t[e][r][i].color==o.color&&t[e][r][i].opacity==o.opacity)},e.prototype.FindAndSetPointBottom=function(t,i,e,r,o,n){var a,s,h,f="bottom",c=i[r][o][e];for(n.x=e,n.y=r,n.z=o,a=e;a<=t.maxX&&(this.isSameMaterial(i,a,r,o,c)&&!i[r][o][a][f]);a++)i[r][o][a][f]=!0,n.x=a;for(s=o+1;s<=t.maxZ;s++){for(h=!1,a=e;a<=n.x;a++)if(!this.isSameMaterial(i,a,r,s,c)||i[r][s][a][f]){h=!0;break}if(h)break;for(a=e;a<=n.x;a++)i[r][s][a][f]=!0;n.z=s}},e.prototype.FindAndSetPointTop=function(t,i,e,r,o,n){var a,s,h,f=i[r][o][e];for(n.x=e,n.y=r,n.z=o,a=e;a<=t.maxX&&(this.isSameMaterial(i,a,r,o,f)&&!i[r][o][a].top);a++)i[r][o][a].top=!0,n.x=a;for(s=o-1;s>=t.minZ;s--){for(h=!1,a=e;a<=n.x;a++)if(!this.isSameMaterial(i,a,r,s,f)||i[r][s][a].top){h=!0;break}if(h)break;for(a=e;a<=n.x;a++)i[r][s][a].top=!0;n.z=s}},e.prototype.FindAndSetPointRight=function(t,i,e,r,o,n){var a,s,h,f=i[r][o][e];for(n.x=e,n.y=r,n.z=o,s=o;s>=t.minZ&&(this.isSameMaterial(i,e,r,s,f)&&!i[r][s][e].right);s--)i[r][s][e].right=!0,n.z=s;for(a=r+1;a<=t.maxY;a++){for(h=!1,s=o;s>=n.z;s--)if(!this.isSameMaterial(i,e,a,s,f)||i[a][s][e].right){h=!0;break}if(h)break;for(s=o;s>=n.z;s--)i[a][s][e].right=!0;n.y=a}},e.prototype.FindAndSetPointLeft=function(t,i,e,r,o,n){var a,s,h,f=i[r][o][e];for(n.x=e,n.y=r,n.z=o,s=o;s<=t.maxZ&&(this.isSameMaterial(i,e,r,s,f)&&!i[r][s][e].left);s++)i[r][s][e].left=!0,n.z=s;for(a=r+1;a<=t.maxY;a++){for(h=!1,s=o;s<=n.z;s++)if(!this.isSameMaterial(i,e,a,s,f)||i[a][s][e].left){h=!0;break}if(h)break;for(s=o;s<=n.z;s++)i[a][s][e].left=!0;n.y=a}},e.prototype.FindAndSetPointBack=function(t,i,e,r,o,n){var a,s,h,f=i[r][o][e];for(n.x=e,n.y=r,n.z=o,a=e;a>=t.minX&&(this.isSameMaterial(i,a,r,o,f)&&!i[r][o][a].back);a--)i[r][o][a].back=!0,n.x=a;for(s=r+1;s<=t.maxY;s++){for(h=!1,a=e;a>=n.x;a--)if(!this.isSameMaterial(i,a,s,o,f)||i[s][o][a].back){h=!0;break}if(h)break;for(a=e;a>=n.x;a--)i[s][o][a].back=!0;n.y=s}},e.prototype.FindAndSetPointFront=function(t,i,e,r,o,n){var a,s,h,f=i[r][o][e];for(n.x=e,n.y=r,n.z=o,a=e;a<=t.maxX&&(this.isSameMaterial(i,a,r,o,f)&&!i[r][o][a].front);a++)i[r][o][a].front=!0,n.x=a;for(s=r+1;s<=t.maxY;s++){for(h=!1,a=e;a<=n.x;a++)if(!this.isSameMaterial(i,a,s,o,f)||i[s][o][a].front){h=!0;break}if(h)break;for(a=e;a<=n.x;a++)i[s][o][a].front=!0;n.y=s}},e.prototype.canIgnore=function(t,i,e,r,o,n,a){if(!t[e][r][i])return!0;if(t[n]&&t[n][a]&&t[n][a][o]){if(void 0===t[n][a][o].opacity||t[n][a][o].opacity>=1)return!0;if(t[e][r][i].opacity==t[n][a][o].opacity&&t[e][r][i].color==t[n][a][o].color)return!0}return!1},e.prototype.getPointIdx=function(t,i,e,r){var o=e-t.minY,n=r-t.minZ,a=i-t.minX,s=o*t.width*t.depth;return s+=n*t.width,8*(s+=a)},e.prototype.buildAFace=function(t,i,e,r,o,n,a,s,h){t.push([i,e,r,a,s,h]),t.push([i,r,o,a,s,h]),n[i][3]++,n[e][3]++,n[r][3]++,n[o][3]++},e.prototype.buildFaces=function(t){var i,e,r,o,n,a,s,h=this.bound,f=this.map,c=[],p={x:0,y:0,z:0};if(this.showFaces.front)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(r=h.minX;r<=h.maxX;r++)f[i][e][r]&&(this.canIgnore(f,r,i,e,r,i,e+1)||f[i][e][r].front||(this.FindAndSetPointFront(h,f,r,i,e,p),o=this.getPointIdx(h,r,i,e),n=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,p.y,e),s=this.getPointIdx(h,r,p.y,e),this.buildAFace(c,o,n+1,a+2,s+3,t,f[i][e][r],Math.abs(r-p.x)+1,Math.abs(i-p.y)+1)));if(this.showFaces.back)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(r=h.maxX;r>=h.minX;r--)f[i][e][r]&&(this.canIgnore(f,r,i,e,r,i,e-1)||f[i][e][r].back||(this.FindAndSetPointBack(h,f,r,i,e,p),o=this.getPointIdx(h,r,i,e),n=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,p.y,e),s=this.getPointIdx(h,r,p.y,e),this.buildAFace(c,o+5,n+4,a+7,s+6,t,f[i][e][r],Math.abs(r-p.x)+1,Math.abs(i-p.y)+1)));if(this.showFaces.left)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(r=h.minX;r<=h.maxX;r++)f[i][e][r]&&(this.canIgnore(f,r,i,e,r-1,i,e)||f[i][e][r].left||(this.FindAndSetPointLeft(h,f,r,i,e,p),o=this.getPointIdx(h,r,i,e),n=this.getPointIdx(h,r,i,p.z),a=this.getPointIdx(h,r,p.y,p.z),s=this.getPointIdx(h,r,p.y,e),this.buildAFace(c,o+4,n,a+3,s+7,t,f[i][e][r],Math.abs(e-p.z)+1,Math.abs(i-p.y)+1)));if(this.showFaces.right)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(r=h.maxX;r>=h.minX;r--)f[i][e][r]&&(this.canIgnore(f,r,i,e,r+1,i,e)||f[i][e][r].right||(this.FindAndSetPointRight(h,f,r,i,e,p),o=this.getPointIdx(h,r,i,e),n=this.getPointIdx(h,r,i,p.z),a=this.getPointIdx(h,r,p.y,p.z),s=this.getPointIdx(h,r,p.y,e),this.buildAFace(c,o+1,n+5,a+6,s+2,t,f[i][e][r],Math.abs(e-p.z)+1,Math.abs(i-p.y)+1)));if(this.showFaces.top)for(i=h.maxY;i>=h.minY;i--)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(r=h.minX;r<=h.maxX;r++)f[i][e][r]&&(this.canIgnore(f,r,i,e,r,i+1,e)||f[i][e][r].top||(this.FindAndSetPointTop(h,f,r,i,e,p),o=this.getPointIdx(h,r,i,e),n=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,i,p.z),s=this.getPointIdx(h,r,i,p.z),this.buildAFace(c,o+3,n+2,a+6,s+7,t,f[i][e][r],Math.abs(r-p.x)+1,Math.abs(e-p.z)+1)));if(this.showFaces.bottom)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(r=h.minX;r<=h.maxX;r++)f[i][e][r]&&(this.canIgnore(f,r,i,e,r,i-1,e)||f[i][e][r].bottom||(this.FindAndSetPointBottom(h,f,r,i,e,p),o=this.getPointIdx(h,r,i,e),n=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,i,p.z),s=this.getPointIdx(h,r,i,p.z),this.buildAFace(c,o+4,n+5,a+1,s+0,t,f[i][e][r],Math.abs(r-p.x)+1,Math.abs(e-p.z)+1)));return c},e.prototype.buildVertices=function(){var t,i,e,r,o,n,a=this.bound,s=this.width,h=this.height,f=this.depth,c=this.center,p=[],m=0,u=.5*s,d=.5*h,x=.5*f;for(t=a.minY;t<=a.maxY;t++)for(i=a.minZ;i<=a.maxZ;i++)for(e=a.minX;e<=a.maxX;e++)r=-c.x+e*s,o=-c.y+t*h,n=-c.z+i*f,p.push([r-u,o-d,n+x,0,m++]),p.push([r+u,o-d,n+x,0,m++]),p.push([r+u,o+d,n+x,0,m++]),p.push([r-u,o+d,n+x,0,m++]),p.push([r-u,o-d,n-x,0,m++]),p.push([r+u,o-d,n-x,0,m++]),p.push([r+u,o+d,n-x,0,m++]),p.push([r-u,o+d,n-x,0,m++]);return p},e.prototype.getCenter2=function(t,i,e,r){return t*e+(i-t)*e*r},e.prototype.getCenter=function(t){var i,e,r,o,n,a,s=this.bound,h=this.width,f=this.height,c=this.depth,p={};return void 0===t&&(t="center"),"string"==typeof t?(t=t.trim(),aligns=t.split(" "),3==aligns.length?("left"==aligns[0]?(i=0,o=-.5):"right"==aligns[0]?(i=1,o=.5):(i=.5,o=0),"bottom"==aligns[1]?(e=0,n=-.5):"top"==aligns[1]?(e=1,n=.5):(e=.5,n=0),"back"==aligns[2]?(r=0,a=-.5):"front"==aligns[2]?(r=1,a=.5):(r=.5,a=0)):"left"==t?(i=e=r=0,o=n=a=-.5):"right"==t?(i=e=r=1,o=n=a=.5):(i=e=r=.5,o=n=a=0),console.log(a,r),p.x=this.getCenter2(s.minX,s.maxX,h,i)+o*h,p.y=this.getCenter2(s.minY,s.maxY,f,e)+n*f,p.z=this.getCenter2(s.minZ,s.maxZ,c,r)+a*c):(p.x=t.x,p.y=t.y,p.z=t.z),console.log(p),p},e.prototype.getBound=function(t){var i,e,r,o,n=1/0,a=-1/0,s=1/0,h=-1/0,f=1/0,c=-1/0;for(i in t)for(e in n=Math.min(n,i),a=Math.max(a,i),o=t[i])for(r in s=Math.min(s,e),h=Math.max(h,e),o[e])f=Math.min(f,r),c=Math.max(c,r);return{minY:n,maxY:a,minZ:s,maxZ:h,minX:f,maxX:c,width:c-f+1,height:a-n+1,depth:h-s+1}}},function(t,i,e){e(0),t.exports=e(2)},function(t,i){AFRAME.registerComponent("mergedVoxels",{schema:{src:{type:"string",default:""}},init:function(){if(this.data.src){info=JSON.parse(this.data.src);var t=this.el;new MergedVoxels(info).run((function(i,e){t.setObject3D("mesh",e)}))}}}),AFRAME.registerPrimitive("a-mergedVoxels",{defaultComponents:{MergedVoxels:{}},mappings:{src:"mergedVoxels.src"}})}]);