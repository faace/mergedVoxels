!function(t){var i={};function e(o){if(i[o])return i[o].exports;var n=i[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:o})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var n in t)e.d(o,n,function(i){return t[i]}.bind(null,n));return o},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=2)}([function(t,i,e){(function(i){!function(){var e=function(t){this.init(t)};"undefined"!=typeof window?window.MergedVoxels=e:void 0!==i&&(i.MergedVoxels=e),t.exports&&(t.exports=e),e.prototype.init=function(t){return this.info=t,this.options=t.options||{},this.map=JSON.parse(JSON.stringify(t.map))||{},this.textures=this.info.textures||{},this.width=t.width||1,this.height=t.height||1,this.depth=t.depth||1,this.align=t.align,this.showFaces=t.showFaces||{front:!0,back:!0,left:!0,right:!0,top:!0,bottom:!0},this},e.prototype.run=function(t){this.bound||(this.bound=this.getBound(this.map)),this.center||(this.center=this.getCenter(this.align));var i=this.buildVertices(),e=this.buildFaces(i);this.updateVertices(i),this.updateFaces(i,e),this.materials=[],this.materialsMap={},this.texturesMap={};var o=this.createGeometry(i,e);t(!1,new THREE.Mesh(o,this.materials))},e.prototype.getMaterial=function(t,i,e){var o=this.textures,n={};if(this.options.polygonOffset&&(n.polygonOffset=!0,n.polygonOffsetFactor=this.options.polygonOffsetFactor||-1,n.polygonOffsetUnits=this.options.polygonOffsetUnits||-4),o[t]){var r,a=o[t];if("string"!=typeof a)r=a.src;else{var s=document.querySelector("#"+o[t]);r=s&&(s.src||s[0]&&s[0].src)}if(r){var h=(new THREE.TextureLoader).load(r);return h.wrapS=THREE.RepeatWrapping,h.wrapT=THREE.RepeatWrapping,h.repeat.set(i,e),n.map=h,new THREE.MeshBasicMaterial(map)}}return n.color=t,new THREE.MeshPhongMaterial(n)},e.prototype.getMaterialIdx=function(t,i,e){var o=t.color,n=t.opacity,r=o+"_"+n+"_"+i+"_"+e;if(void 0===this.materialsMap[r]){var a=this.getMaterial(o,i,e);n&&(a.transparent=!0,a.opacity=n),this.materialsMap[r]=this.materials.length,this.materials.push(a)}return this.materialsMap[r]},e.prototype.createGeometry=function(t,i){for(var e=new THREE.Geometry,o=0;o<t.length;o++)t[o][3]&&e.vertices.push(new THREE.Vector3(t[o][0],t[o][1],t[o][2]));e.computeBoundingBox();var n,r,a=e.faceVertexUvs[0],s=new THREE.Vector2(0,0),h=new THREE.Vector2(1,0),f=new THREE.Vector2(1,1),c=[s,h,f],p=[s,f,new THREE.Vector2(0,1)];for(o=0;o<i.length;o++)n=i[o],r=this.getMaterialIdx(n[3],n[4],n[5]),e.faces.push(new THREE.Face3(n[0],n[1],n[2],void 0,void 0,r)),a.push(c,p);return e.computeFaceNormals(),e},e.prototype.updateFaces=function(t,i){for(var e=0;e<i.length;e++)i[e][0]=t[i[e][0]][4],i[e][1]=t[i[e][1]][4],i[e][2]=t[i[e][2]][4]},e.prototype.updateVertices=function(t){for(var i=0,e=0;e<t.length;e++)t[e][3]&&(t[e][4]=i++)},e.prototype.isSameMaterial=function(t,i,e,o,n){return!!(t[e]&&t[e][o]&&t[e][o][i]&&t[e][o][i].color==n.color&&t[e][o][i].opacity==n.opacity)},e.prototype.FindAndSetPointBottom=function(t,i,e,o,n,r){var a,s,h,f="bottom",c=i[o][n][e];for(r.x=e,r.y=o,r.z=n,a=e;a<=t.maxX&&!this.canIgnore(i,a,o,n,a,o-1,n)&&(this.isSameMaterial(i,a,o,n,c)&&!i[o][n][a][f]);a++)i[o][n][a][f]=!0,r.x=a;for(s=n+1;s<=t.maxZ;s++){for(h=!1,a=e;a<=r.x;a++)if(this.canIgnore(i,a,o,s,a,o-1,s)||!this.isSameMaterial(i,a,o,s,c)||i[o][s][a][f]){h=!0;break}if(h)break;for(a=e;a<=r.x;a++)i[o][s][a][f]=!0;r.z=s}},e.prototype.FindAndSetPointTop=function(t,i,e,o,n,r){var a,s,h,f=i[o][n][e];for(r.x=e,r.y=o,r.z=n,a=e;a<=t.maxX&&!this.canIgnore(i,a,o,n,a,o+1,n)&&(this.isSameMaterial(i,a,o,n,f)&&!i[o][n][a].top);a++)i[o][n][a].top=!0,r.x=a;for(s=n-1;s>=t.minZ;s--){for(h=!1,a=e;a<=r.x;a++)if(this.canIgnore(i,a,o,s,a,o+1,s)||!this.isSameMaterial(i,a,o,s,f)||i[o][s][a].top){h=!0;break}if(h)break;for(a=e;a<=r.x;a++)i[o][s][a].top=!0;r.z=s}},e.prototype.FindAndSetPointRight=function(t,i,e,o,n,r){var a,s,h,f=i[o][n][e];for(r.x=e,r.y=o,r.z=n,s=n;s>=t.minZ&&!this.canIgnore(i,e,o,s,e+1,o,s)&&(this.isSameMaterial(i,e,o,s,f)&&!i[o][s][e].right);s--)i[o][s][e].right=!0,r.z=s;for(a=o+1;a<=t.maxY;a++){for(h=!1,s=n;s>=r.z;s--)if(this.canIgnore(i,e,a,s,e+1,a,s)||!this.isSameMaterial(i,e,a,s,f)||i[a][s][e].right){h=!0;break}if(h)break;for(s=n;s>=r.z;s--)i[a][s][e].right=!0;r.y=a}},e.prototype.FindAndSetPointLeft=function(t,i,e,o,n,r){var a,s,h,f=i[o][n][e];for(r.x=e,r.y=o,r.z=n,s=n;s<=t.maxZ&&!this.canIgnore(i,e,o,s,e-1,o,s)&&(this.isSameMaterial(i,e,o,s,f)&&!i[o][s][e].left);s++)i[o][s][e].left=!0,r.z=s;for(a=o+1;a<=t.maxY;a++){for(h=!1,s=n;s<=r.z;s++)if(this.canIgnore(i,e,a,s,e-1,a,s)||!this.isSameMaterial(i,e,a,s,f)||i[a][s][e].left){h=!0;break}if(h)break;for(s=n;s<=r.z;s++)i[a][s][e].left=!0;r.y=a}},e.prototype.FindAndSetPointBack=function(t,i,e,o,n,r){var a,s,h,f=i[o][n][e];for(r.x=e,r.y=o,r.z=n,a=e;a>=t.minX&&!this.canIgnore(i,a,o,n,a,o,n-1)&&(this.isSameMaterial(i,a,o,n,f)&&!i[o][n][a].back);a--)i[o][n][a].back=!0,r.x=a;for(s=o+1;s<=t.maxY;s++){for(h=!1,a=e;a>=r.x;a--)if(this.canIgnore(i,a,s,n,a,s,n-1)||!this.isSameMaterial(i,a,s,n,f)||i[s][n][a].back){h=!0;break}if(h)break;for(a=e;a>=r.x;a--)i[s][n][a].back=!0;r.y=s}},e.prototype.FindAndSetPointFront=function(t,i,e,o,n,r){var a,s,h,f=i[o][n][e];for(r.x=e,r.y=o,r.z=n,a=e;a<=t.maxX&&!this.canIgnore(i,a,o,n,a,o,n+1)&&(this.isSameMaterial(i,a,o,n,f)&&!i[o][n][a].front);a++)i[o][n][a].front=!0,r.x=a;for(s=o+1;s<=t.maxY;s++){for(h=!1,a=e;a<=r.x;a++)if(this.canIgnore(i,a,s,n,a,s,n+1)||!this.isSameMaterial(i,a,s,n,f)||i[s][n][a].front){h=!0;break}if(h)break;for(a=e;a<=r.x;a++)i[s][n][a].front=!0;r.y=s}},e.prototype.canIgnore=function(t,i,e,o,n,r,a){if(!t[e][o][i])return!0;if(t[r]&&t[r][a]&&t[r][a][n]){if(void 0===t[r][a][n].opacity||t[r][a][n].opacity>=1)return!0;if(t[e][o][i].opacity==t[r][a][n].opacity&&t[e][o][i].color==t[r][a][n].color)return!0}return!1},e.prototype.getPointIdx=function(t,i,e,o){var n=e-t.minY,r=o-t.minZ,a=i-t.minX,s=n*t.width*t.depth;return s+=r*t.width,8*(s+=a)},e.prototype.buildAFace=function(t,i,e,o,n,r,a,s,h){t.push([i,e,o,a,s,h]),t.push([i,o,n,a,s,h]),r[i][3]++,r[e][3]++,r[o][3]++,r[n][3]++},e.prototype.buildFaces=function(t){var i,e,o,n,r,a,s,h=this.bound,f=this.map,c=[],p={x:0,y:0,z:0};if(this.showFaces.front)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i,e+1)||f[i][e][o].front||(this.FindAndSetPointFront(h,f,o,i,e,p),n=this.getPointIdx(h,o,i,e),r=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,p.y,e),s=this.getPointIdx(h,o,p.y,e),this.buildAFace(c,n,r+1,a+2,s+3,t,f[i][e][o],Math.abs(o-p.x)+1,Math.abs(i-p.y)+1)));if(this.showFaces.back)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(o=h.maxX;o>=h.minX;o--)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i,e-1)||f[i][e][o].back||(this.FindAndSetPointBack(h,f,o,i,e,p),n=this.getPointIdx(h,o,i,e),r=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,p.y,e),s=this.getPointIdx(h,o,p.y,e),this.buildAFace(c,n+5,r+4,a+7,s+6,t,f[i][e][o],Math.abs(o-p.x)+1,Math.abs(i-p.y)+1)));if(this.showFaces.left)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o-1,i,e)||f[i][e][o].left||(this.FindAndSetPointLeft(h,f,o,i,e,p),n=this.getPointIdx(h,o,i,e),r=this.getPointIdx(h,o,i,p.z),a=this.getPointIdx(h,o,p.y,p.z),s=this.getPointIdx(h,o,p.y,e),this.buildAFace(c,n+4,r,a+3,s+7,t,f[i][e][o],Math.abs(e-p.z)+1,Math.abs(i-p.y)+1)));if(this.showFaces.right)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(o=h.maxX;o>=h.minX;o--)f[i][e][o]&&(this.canIgnore(f,o,i,e,o+1,i,e)||f[i][e][o].right||(this.FindAndSetPointRight(h,f,o,i,e,p),n=this.getPointIdx(h,o,i,e),r=this.getPointIdx(h,o,i,p.z),a=this.getPointIdx(h,o,p.y,p.z),s=this.getPointIdx(h,o,p.y,e),this.buildAFace(c,n+1,r+5,a+6,s+2,t,f[i][e][o],Math.abs(e-p.z)+1,Math.abs(i-p.y)+1)));if(this.showFaces.top)for(i=h.maxY;i>=h.minY;i--)if(f[i])for(e=h.maxZ;e>=h.minZ;e--)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i+1,e)||f[i][e][o].top||(this.FindAndSetPointTop(h,f,o,i,e,p),n=this.getPointIdx(h,o,i,e),r=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,i,p.z),s=this.getPointIdx(h,o,i,p.z),this.buildAFace(c,n+3,r+2,a+6,s+7,t,f[i][e][o],Math.abs(o-p.x)+1,Math.abs(e-p.z)+1)));if(this.showFaces.bottom)for(i=h.minY;i<=h.maxY;i++)if(f[i])for(e=h.minZ;e<=h.maxZ;e++)if(f[i][e])for(o=h.minX;o<=h.maxX;o++)f[i][e][o]&&(this.canIgnore(f,o,i,e,o,i-1,e)||f[i][e][o].bottom||(this.FindAndSetPointBottom(h,f,o,i,e,p),n=this.getPointIdx(h,o,i,e),r=this.getPointIdx(h,p.x,i,e),a=this.getPointIdx(h,p.x,i,p.z),s=this.getPointIdx(h,o,i,p.z),this.buildAFace(c,n+4,r+5,a+1,s+0,t,f[i][e][o],Math.abs(o-p.x)+1,Math.abs(e-p.z)+1)));return c},e.prototype.buildVertices=function(){var t,i,e,o,n,r,a=this.bound,s=this.width,h=this.height,f=this.depth,c=this.center,p=[],u=0,m=.5*s,d=.5*h,x=.5*f;for(t=a.minY;t<=a.maxY;t++)for(i=a.minZ;i<=a.maxZ;i++)for(e=a.minX;e<=a.maxX;e++)o=-c.x+e*s,n=-c.y+t*h,r=-c.z+i*f,p.push([o-m,n-d,r+x,0,u++]),p.push([o+m,n-d,r+x,0,u++]),p.push([o+m,n+d,r+x,0,u++]),p.push([o-m,n+d,r+x,0,u++]),p.push([o-m,n-d,r-x,0,u++]),p.push([o+m,n-d,r-x,0,u++]),p.push([o+m,n+d,r-x,0,u++]),p.push([o-m,n+d,r-x,0,u++]);return p},e.prototype.getCenter2=function(t,i,e,o){return t*e+(i-t)*e*o},e.prototype.getCenter=function(t){var i,e,o,n,r,a,s=this.bound,h=this.width,f=this.height,c=this.depth,p={};return void 0===t&&(t="center"),"string"==typeof t?(t=t.trim(),aligns=t.split(" "),3==aligns.length?("left"==aligns[0]?(i=0,n=-.5):"right"==aligns[0]?(i=1,n=.5):(i=.5,n=0),"bottom"==aligns[1]?(e=0,r=-.5):"top"==aligns[1]?(e=1,r=.5):(e=.5,r=0),"back"==aligns[2]?(o=0,a=-.5):"front"==aligns[2]?(o=1,a=.5):(o=.5,a=0)):"left"==t?(i=e=o=0,n=r=a=-.5):"right"==t?(i=e=o=1,n=r=a=.5):(i=e=o=.5,n=r=a=0),console.log(a,o),p.x=this.getCenter2(s.minX,s.maxX,h,i)+n*h,p.y=this.getCenter2(s.minY,s.maxY,f,e)+r*f,p.z=this.getCenter2(s.minZ,s.maxZ,c,o)+a*c):(p.x=t.x,p.y=t.y,p.z=t.z),console.log(p),p},e.prototype.getBound=function(t){var i,e,o,n,r=1/0,a=-1/0,s=1/0,h=-1/0,f=1/0,c=-1/0;for(i in t)for(e in r=Math.min(r,i),a=Math.max(a,i),n=t[i])for(o in s=Math.min(s,e),h=Math.max(h,e),n[e])f=Math.min(f,o),c=Math.max(c,o);return{minY:r,maxY:a,minZ:s,maxZ:h,minX:f,maxX:c,width:c-f+1,height:a-r+1,depth:h-s+1}}}()}).call(this,e(1))},function(t,i){var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},function(t,i,e){e(0),t.exports=e(3)},function(t,i){AFRAME.registerComponent("mergedvoxels",{schema:{src:{type:"string",default:""}},init:function(){if(this.data.src){info=JSON.parse(this.data.src);var t=this.el;new MergedVoxels(info).run((function(i,e){t.setObject3D("mesh",e)}))}}}),AFRAME.registerPrimitive("a-mergedvoxels",{defaultComponents:{mergedvoxels:{}},mappings:{src:"mergedvoxels.src"}})}]);